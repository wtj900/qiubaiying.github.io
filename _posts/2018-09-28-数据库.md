---
layout:     post
title:      数据库学习
subtitle:   数据库
date:       2018-09-28
author:     JT
header-img: img/post-bg-github-cup.jpg
catalog:    true
tags:
    - 数据库
---

## 简介

数据库（Database，DB）

数据库管理系统（Database Management System，DBMS）
   
> DBMS种类：

* 层次型数据库（Hierarchical HDB):数据通过层次结构（木结构）的方式表现出来，现在很少使用

* 关系型数据库（Ralational RDB）:通过二维表结构来管理数据，使用SQL（Structured Query Language,结构化查询语言）对数据进行操作（Oracle，甲骨文；SQL Server，微软；DB2，IBM；MySQL等）

* 面向对象数据库（OODB）:把数据和对数据的操作集合起来以对象为单位进行管理

* XML数据库（XMLDB）：可以对XML形式的大量数据进行告诉操作

* 键值存储系统（KVS）:用来保存用于查询所使用的主键和值得组合的数据库


> SQL语句种类：

* DDL(Data Definiton Language，数据定义语言)：用于创建或删除存储数据用的数据库以及数据库中表等对象
 * CREATE:创建
 * DROP:删除
 * ALTER:修改

* DML(Data Manipulation Language，数据操作语言)：用于查询和变更表中的记录
 * SELECT：查询
 * INSERT：插入
 * UPDATE：更新
 * DELETE：删除
 
* DCL(Data Control Language，数据控制语言)：用于确认和取消对数据库中的数据进行的变更，还可以对RDBMS中的用户是否有权限操作数据库的对象进行设定
 * COMMIT：确认变更
 * ROLLBACK：取消变更
 * GRANT：赋予操作权限
 * REVOKE：取消操作权限

> SQL书写规则

* 以分号结尾
* 关键字不区分大小写
* 常数（字符串及日期用单引号标记，数字直接书写）
* 单词之间要用半角空格或换行符分割

## 表的创建

只能使用半角英文字母、数字、下划线作为数据库、表、列的名称。

> 创建数据库

`CREATE DATABASE 数据库名字;` 例：`CREATE DATABASE SHOP;`

> 创建表

`CREATE TABLE 表名 (列名1 类型 约束, 列名2 类型 约束, ..., 表约束1, 表约束2, ...)`

例：

`CREATE TABLE Shohin (shohin_id CHAR(4) NOT NULL, shohin_mei VARCHAR(100) NOT NULL, PRIMARY KEY (shohin_id));`

> 数据类型

* INTEGER:整型

* CHAR:CHAR(8)用于指定字符串的存储的最大长度，超出部分无法输入，不足的会以半角空格补足

* VARCHAR: VARCHAR(8)用于指定字符串的存储的最大长度，超出部分无法输入，不足的不会补足

* DATE:存储日期

> 约束的设置

约束是除了数据类型之外，队列中存储数据进行限制或追加条件

* NOT NULL:输入不能为空，否则出错
* PRIMARY KEY：主键约束，唯一，通过主键取出唯一数据

## 表的删除和更新

> 删除表

 `DROP TABLE 表名`，**删除后无法恢复**，例：`DROP TABLE Shohin;`

> 添加或删除列

* 添加列

 `ALTER TABLE 表名 ADD COLUMN 列名 类型 约束;`
 
 Oracle和SQL Server 中不用写COLUMN

 `ALTER TABLE 表名 ADD (列名 类型 约束);`

Oracle中可以添加多列

  `ALTER TABLE 表名 ADD (列名 类型 约束，列名 类型 约束，...);`
  
* 删除列

 `ALTER TABLE 表名 DROP COLUMN 列名;`
 
  Oracle和SQL Server 中不用写COLUMN

 `ALTER TABLE 表名 DROP (列名);`

Oracle中可以添加多列

  `ALTER TABLE 表名 DROP (列名 类型 约束，列名 类型 约束，...);`
  
* 变更表名
  
  `ALTER TABLE 表名 RENAME TO 新表名`;

  
## 查询语句
  
> 列查询

`SELECT 列名1, 列名2, ... FROM 表名;` 查询列数据

`SELECT * FROM 表名;` 查询所有列数据

> 列设定别名

`SELECT 列名1 AS 别名1, 列名2 AS 别名2, ... FROM 表名;`

当别名为汉字时需要使用**双引号**括起来。

例：`SELECT shohin_id AS “商品编号” FROM Shohin;`

> 常数查询

`SELECT '商品' AS moji, 38 AS price, shohin_id FROM Shohin;`

将“moji”和“price”字段设定为指定的常数。

> 从结果中删除重复行

`SELECT DISTINCT 列名1, 列名2, ... FROM 表名;`

当有多个字段时，会将一条数据当做判断是否重复的标准。

NULL也会被视为一类数据，多个NULL会合并为一个。

> WHERE

`SELECT 列名, ... FROM 表名 WHERE 条件表达式;`

> 算数运算符(“+” 、“-”、“*”、“/”)

例：`SELECT price, price * 2 AS price_x2 From 表名;`

会将“price * 2”的结果作为后一个的结果输出。

> 比较运算符（“=”、“<>”、“>”、“>=”、“<”、“<=”）

WHERE选择用

> 逻辑运算符

* NOT 取反
* AND 与
* OR  或

SQL 有真、假、不确定三种情况。

> NULL 

NULL 的任何运算结果都是NULL;

比较是不是NULL， 要用 IS NULL或IS NOT NULL;

NULL 是属于不确定行列的数据


## 聚合与排序

> 常用的聚合函数

所有的聚合函数如果以列为参数，那么在计算之前就已经把NULL排除在外了。

* COUNT:行数
  
  COUNT(*)或计算或有的行数包含NULL, COUNT(列名)会去除当前列为NULL的记录。
  
* SUM:数值列的合计值

  `SELECT SUM(列名),SUM(列名) FROM 表明;`

* AVG:数值列的平均值

  `SELECT AVG(列名),AVG(列名) FROM 表明;`

* MAX:任意列的最大值

  `SELECT MAX(列名),MAX(列名) FROM 表明;`
  
* MIN:任意列的最小值

  `SELECT MIN(列名),MIN(列名) FROM 表明;`

* 使用聚合函数删除重复值，所有的聚合函数都可以使用DISTINCT

  例：`SELECT COUNT(DISTINCT 列名) FROM 表明;` 先删除重复数据再计算数量
  
> 分组 GROUP BY

* 聚合键中包含NULL时，在结果中会以“不确定”行的形式表现出来。
* 使用聚合函数和GROUP BY子句时注意
  * 只能写在SELECT语句中
  * GROUP BY子句中不能使用别名
  * GROUP BY子句中的聚合结果是无序的
  * WHERE子句中不能使用聚合函数

`SELECT 列名1, 列名2, ... FROM 表名 GROUP BY 列名1, 列名2, ...;` 

子句中的书写顺序：

SELECT ... FROM ... WHERE ... GROUP BY










  
  